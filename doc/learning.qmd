---
title: "Draft Quarto document - Advanced Reproductible Research in R"
author: "María José Romero Lado"
format: html
---

```{r setup}
#| include: false
# the line below is correcting the path - as it is confusing for targets to find the quarto document inside doc folder ; it is saying go back one level and look in the _targets folder
targets::tar_config_set(store = here::here("_targets")) # here is used for relative paths
library(tidyverse)
library(targets)
library(tidymodels)

source(here::here("R/functions.R"))
# lipidomics <- read_csv(here::here("data/lipidomics.csv"))
lipidomics <- tar_read(lipidomics)
```

## Results

```{r}
tar_read(df_stats_by_metabolite) |>
    mutate(MeanSD = glue::glue("{value_mean} ({value_sd})")) |>
    select(Metabolite = metabolite, `Mean SD` = MeanSD) |>
    knitr::kable(caption = "Descriptive statistics of the metabolites.")
```

```{r}
tar_read(fig_metabolite_distribution)
```

## Building the model

```{r}
lipidomics_wide <- lipidomics |>
    # to make sure that the characters are understandable for the program
  mutate(metabolite = snakecase::to_snake_case(metabolite)) |>
  pivot_wider(
    names_from = metabolite, # will place mtb in columns
    values_from = value, # values per individual per mtb 
    values_fn = mean, # this will average whenever there are multiple measurements per mtb - i.e. cholesterol
    names_prefix = "metabolite_"
  )
lipidomics_wide
```

```{r}
create_model_workflow(
  logistic_reg() |>
    set_engine("glm"),
  lipidomics_wide |>
    create_recipe_spec(metabolite_cholesterol)
) |>
  fit(lipidomics_wide) |>
  tidy_model_output()
```
